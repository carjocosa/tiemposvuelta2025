<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gesti√≥n de Tiempos de Rally</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .navigation {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .nav-btn {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .nav-btn.active {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            transform: scale(1.05);
        }

        .screen {
            display: none;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Pantalla de Control */
        .control-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #FFD700;
        }

        select, input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.9);
            color: #333;
            font-size: 16px;
        }

        .time-input {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .time-input input {
            text-align: center;
            font-weight: bold;
        }

        .submit-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            width: 100%;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        /* Tablas */
        .table-container {
            background: rgba(255,255,255,0.95);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: #333;
        }

        th {
            background: linear-gradient(45deg, #333, #555);
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: bold;
        }

        td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }

        tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        tr:hover {
            background-color: #e3f2fd;
        }

        .position {
            font-weight: bold;
            font-size: 18px;
            color: #007bff;
        }

        .time {
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .differential {
            font-style: italic;
            color: #666;
        }

        .positive { color: #dc3545; }
        .negative { color: #28a745; }
        .neutral { color: #6c757d; }

        /* Filtros */
        .filters {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        /* Estados */
        .status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .status.completed { background: #d4edda; color: #155724; }
        .status.pending { background: #fff3cd; color: #856404; }

        /* Responsive */
        @media (max-width: 768px) {
            .control-grid {
                grid-template-columns: 1fr;
            }
            
            .navigation {
                flex-direction: column;
                align-items: center;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .time-input {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Animaciones para cambios de posici√≥n */
        .position-up {
            color: #28a745;
            animation: bounce 0.6s ease;
        }

        .position-down {
            color: #dc3545;
            animation: bounce 0.6s ease;
        }

        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            80% { transform: translateY(-5px); }
        }

        .last-update {
            text-align: center;
            margin-top: 20px;
            font-style: italic;
            color: #FFD700;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÅ Sistema de Gesti√≥n de Tiempos de Rally</h1>
            <p>Gesti√≥n completa de tiempos para competencias de rally</p>
        </div>

        <div class="navigation">
            <button class="nav-btn active" onclick="showScreen('control')">üéõÔ∏è Control</button>
            <button class="nav-btn" onclick="showScreen('visualization')">üìä Visualizaci√≥n</button>
            <button class="nav-btn" onclick="showScreen('general')">üèÜ General</button>
        </div>

        <!-- Pantalla de Control -->
        <div id="control" class="screen active">
            <h2>üéõÔ∏è Panel de Control - Ingreso de Tiempos</h2>
            
            <div class="control-grid">
                <div>
                    <div class="form-group">
                        <label for="etapaSelect">Etapa:</label>
                        <select id="etapaSelect" onchange="updateTramos()">
                            <option value="">Seleccionar Etapa</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="tramoSelect">Tramo Cronometrado:</label>
                        <select id="tramoSelect">
                            <option value="">Seleccionar Tramo</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="autoNumber">N√∫mero de Auto:</label>
                        <select id="autoNumber">
                            <option value="">Seleccionar Auto</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Tiempo (HH:MM:SS.mm):</label>
                        <div class="time-input">
                            <input type="number" id="hours" placeholder="HH" min="0" max="23">
                            <input type="number" id="minutes" placeholder="MM" min="0" max="59">
                            <input type="number" id="seconds" placeholder="SS" min="0" max="59">
                            <input type="number" id="milliseconds" placeholder="mm" min="0" max="99">
                        </div>
                    </div>

                    <button class="submit-btn" onclick="saveTime()">üíæ Guardar Tiempo</button>
                </div>

                <div>
                    <h3>Tiempos Registrados - Tramo Actual</h3>
                    <div class="table-container">
                        <table id="currentStageTable">
                            <thead>
                                <tr>
                                    <th>Pos</th>
                                    <th>Auto</th>
                                    <th>Piloto</th>
                                    <th>Tiempo</th>
                                    <th>Diferencial</th>
                                </tr>
                            </thead>
                            <tbody id="currentStageBody">
                                <tr><td colspan="5">Seleccione etapa y tramo</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pantalla de Visualizaci√≥n -->
        <div id="visualization" class="screen">
            <h2>üìä Visualizaci√≥n por Etapas</h2>
            
            <div class="filters">
                <div class="filter-group">
                    <label for="etapaFilter">Filtrar por Etapa:</label>
                    <select id="etapaFilter" onchange="filterResults()">
                        <option value="">Todas las Etapas</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="categoriaFilter">Filtrar por Categor√≠a:</label>
                    <select id="categoriaFilter" onchange="filterResults()">
                        <option value="">Todas las Categor√≠as</option>
                    </select>
                </div>
            </div>

            <div class="table-container">
                <table id="visualizationTable">
                    <thead>
                        <tr>
                            <th>Pos</th>
                            <th>üîÑ</th>
                            <th>Auto</th>
                            <th>Piloto</th>
                            <th>Categor√≠a</th>
                            <th>Ciudad</th>
                            <th>Tiempo Total</th>
                            <th>Diferencial</th>
                        </tr>
                    </thead>
                    <tbody id="visualizationBody">
                    </tbody>
                </table>
            </div>

            <div class="last-update">
                √öltima actualizaci√≥n: <span id="lastUpdateTime">--:--:--</span>
            </div>
        </div>

        <!-- Pantalla General -->
        <div id="general" class="screen">
            <h2>üèÜ Clasificaci√≥n General</h2>
            
            <div class="filters">
                <div class="filter-group">
                    <label for="generalCategoriaFilter">Filtrar por Categor√≠a:</label>
                    <select id="generalCategoriaFilter" onchange="filterGeneral()">
                        <option value="">Todas las Categor√≠as</option>
                    </select>
                </div>
            </div>

            <div class="table-container">
                <table id="generalTable">
                    <thead>
                        <tr>
                            <th>Pos</th>
                            <th>üîÑ</th>
                            <th>Auto</th>
                            <th>Piloto/Copiloto</th>
                            <th>Categor√≠a</th>
                            <th>Ciudad</th>
                            <th>Tiempo Acumulado</th>
                            <th>Diferencial</th>
                            <th>Etapas</th>
                        </tr>
                    </thead>
                    <tbody id="generalBody">
                    </tbody>
                </table>
            </div>

            <div class="last-update">
                √öltima actualizaci√≥n: <span id="lastUpdateGeneral">--:--:--</span>
            </div>
        </div>
    </div>

    <script>
        // Datos base
        const INSCRIPTOS = [
  {
    "auto": 16,
    "categoria": "RALLY 2 - R5",
    "marca": "VOLKSWAGEN",
    "modelo": "POLO",
    "piloto": "ALFONSO ANTONIO QUIROLA BUSTOS",
    "copiloto": "JOSE LEONARDO ROJAS CORDOVA",
    "ciudad": "GUAYAS"
  },
  {
    "auto": 19,
    "categoria": "RALLY 2 - R5",
    "marca": "CITROEN",
    "modelo": "C3",
    "piloto": "HUGO MARTIN NAVAS PE√ëAHERRERA",
    "copiloto": "DANIEL PATRICIO GALARZA AVILES",
    "ciudad": "AMBATO"
  },
  {
    "auto": 50,
    "categoria": "RC4",
    "marca": "PEUGEOT",
    "modelo": "2008 R4",
    "piloto": "MAURICIO XAVIER HERDOIZA HOLGUIN",
    "copiloto": "JOSE ALVARO SEVILLA CASTRO",
    "ciudad": "AMBATO"
  },
  {
    "auto": 61,
    "categoria": "RC4",
    "marca": "PEUGEOT",
    "modelo": "2008 RALL Y4",
    "piloto": "PEDRO ANDRES GUERRERO ABAD",
    "copiloto": "JUAN GERARDO GUERRERO MALDONADO",
    "ciudad": "CUENCA"
  },
  {
    "auto": 67,
    "categoria": "RC4",
    "marca": "OPEL",
    "modelo": "CORSA",
    "piloto": "DIEGO ESTEBAN SERRANO BENALCAZAR",
    "copiloto": "JUAN FELIPE SERRANO",
    "ciudad": "CUENCA"
  },
  {
    "auto": 87,
    "categoria": "RC5",
    "marca": "RENAULT",
    "modelo": "CLIO R.S",
    "piloto": "IVAN FRANCISCO GONZALEZ MOSCOSO",
    "copiloto": "FERNANDO RODRIGO GAVILANES GRANJA",
    "ciudad": "CUENCA"
  },
  {
    "auto": 89,
    "categoria": "RC5",
    "marca": "RENAULT",
    "modelo": "CLIO RC5",
    "piloto": "ROBERTO CARLOS ARMIJOS ARMIJOS",
    "copiloto": "LUIS EDUARDO ARMIJOS ARMIJOS",
    "ciudad": "EL ORO"
  },
  {
    "auto": 96,
    "categoria": "RC5",
    "marca": "RENAULT",
    "modelo": "CLIO",
    "piloto": "ANDRES ESTEBAN GOMEZ COELLO",
    "copiloto": "MATEO SEBASTIAN GOMEZ COELLO",
    "ciudad": "CUENCA"
  },
  {
    "auto": 120,
    "categoria": "RC2N",
    "marca": "MITSUBISHI",
    "modelo": "LANCER",
    "piloto": "LUIS MIGUEL ASTUDILLO DELGADO",
    "copiloto": "LUIS FRANCISCO MENA MONTOYA",
    "ciudad": "AZUAY"
  },
  {
    "auto": 169,
    "categoria": "RC2N",
    "marca": "MITSUBISHI",
    "modelo": "LANCER EVOLUTION",
    "piloto": "IVAN ALEJANDRO ROMERO CHUNCHO",
    "copiloto": "LUIS DAVID LEON PULLAGUARI",
    "ciudad": "MACHALA"
  },
  {
    "auto": 234,
    "categoria": "T4",
    "marca": "PEUGEOT",
    "modelo": "206",
    "piloto": "ANGEL MANUEL GARCIA GARCIA",
    "copiloto": "MANUEL ALEJANDRO GARCIA NU√ëEZ",
    "ciudad": "GUARANDA"
  },
  {
    "auto": 288,
    "categoria": "T4",
    "marca": "HONDA",
    "modelo": "CRZ",
    "piloto": "ERICK JOSE COELLO LLERENA",
    "copiloto": "JOSE MARCELO COELLO GOMEZ",
    "ciudad": "AMBATO"
  },
  {
    "auto": 302,
    "categoria": "T3",
    "marca": "PEUGEOT",
    "modelo": "206",
    "piloto": "JEAN PIERRE ZAMBRANO TUBAY",
    "copiloto": "JEAN PIERRE NARVAEZ LARA",
    "ciudad": "STO DOMINGO"
  },
  {
    "auto": 311,
    "categoria": "T3",
    "marca": "KIA",
    "modelo": "RIO R",
    "piloto": "CARLOS ANDRES MOGROVEJO JACOME",
    "copiloto": "JUAN JOSE BENALCAZAR CORTE",
    "ciudad": "AMBATO"
  },
  {
    "auto": 347,
    "categoria": "T3",
    "marca": "KIA",
    "modelo": "RIO XCITE",
    "piloto": "JUAN CARLOS VELASCO RON",
    "copiloto": "DIEGO ARELLANO SARASTI",
    "ciudad": "AMBATO"
  },
  {
    "auto": 369,
    "categoria": "T3",
    "marca": "KIA",
    "modelo": "RIO",
    "piloto": "PABLO ANDRES LIZARZABURU CASTILLO",
    "copiloto": "JAIME EDUARDO GALARZA TOVAR",
    "ciudad": "QUITO"
  },
  {
    "auto": 377,
    "categoria": "T3",
    "marca": "KIA",
    "modelo": "RIO 5",
    "piloto": "JOEY ALEXANDER GUEVARA PEREZ",
    "copiloto": "IVAN ANDRES MU√ëOZ VALLEJO",
    "ciudad": "RIOBAMBA"
  },
  {
    "auto": 388,
    "categoria": "T3",
    "marca": "KIA",
    "modelo": "RIO",
    "piloto": "MARLON DAMIAN MEJIA ALVAREZ",
    "copiloto": "PABLO SEBASTIAN MEJIA ALVAREZ",
    "ciudad": "LOJA"
  },
  {
    "auto": 422,
    "categoria": "T1",
    "marca": "HYUNDAI",
    "modelo": "GRAN I10",
    "piloto": "JAIME ROLANDO NARANJO RIVERA",
    "copiloto": "JUAN CARLOS NOBOA LUNA",
    "ciudad": "RIOBAMBA"
  },
  {
    "auto": 427,
    "categoria": "T1",
    "marca": "HYUNDAI",
    "modelo": "GRAND I10",
    "piloto": "ERIK STEVEN NIOLA JIMBO",
    "copiloto": "DANNY ANDRES NIOLA JIMBO",
    "ciudad": "CUENCA"
  },
  {
    "auto": 430,
    "categoria": "T1",
    "marca": "KIA",
    "modelo": "RIO",
    "piloto": "JOSE ISRAEL ZAMORA ULLOA",
    "copiloto": "DAVID ANTONIO GUARNIZO ESPINOSA",
    "ciudad": "CUENCA"
  },
  {
    "auto": 436,
    "categoria": "T1",
    "marca": "HYUNDAI",
    "modelo": "GRAND I10",
    "piloto": "LUIS FELIPE VALVERDE LARREA",
    "copiloto": "KAELY ALEJANDRA ESCUDERO QUI√ëONES",
    "ciudad": "AMBATO"
  },
  {
    "auto": 445,
    "categoria": "T1",
    "marca": "HYUNDAI",
    "modelo": "GRAND I10",
    "piloto": "DIEGO ALEJANDRO ALVAREZ NARANJO",
    "copiloto": "MARCO ESTEBAN VITERI CAICEDO",
    "ciudad": "LATACUNGA"
  },
  {
    "auto": 488,
    "categoria": "T1",
    "marca": "HYUNDAI",
    "modelo": "GRAND I10",
    "piloto": "SANTIAGO NICOLAS REYES LIUT",
    "copiloto": "SANTIAGO NICOLAS REYES ALVEAR",
    "ciudad": "RIOBAMBA"
  },
  {
    "auto": 602,
    "categoria": "TT",
    "marca": "CHEVROLET",
    "modelo": "VITARA",
    "piloto": "RICARDO EFRAIN ZAMBRANO ZAMBRANO",
    "copiloto": "RAMIRO ANTONIO CASTILLO CORNEJO",
    "ciudad": "STO DOMINGO"
  },
  {
    "auto": 637,
    "categoria": "TT",
    "marca": "CHEVROLET",
    "modelo": "VITARA",
    "piloto": "GUSTAVO DAVID CARDENAS VELA",
    "copiloto": "ANDRES FERNANDO IZQUIERDO PADILLA",
    "ciudad": "RIOBAMBA"
  },
  {
    "auto": 643,
    "categoria": "TT",
    "marca": "CHEVROLET",
    "modelo": "VITARA",
    "piloto": "JOSE ANDRES SANTAMARIA LARA",
    "copiloto": "CAROLINA LARA ACOSTA",
    "ciudad": "SANGOLQUI"
  },
  {
    "auto": 648,
    "categoria": "TT",
    "marca": "CHEVROLET",
    "modelo": "VITARA",
    "piloto": "CESAR GUSTAVO LARA BUENA√ëO",
    "copiloto": "RENATA VALENTINA NOVOA PROA√ëO",
    "ciudad": "SANGOLQUI"
  },
  {
    "auto": 676,
    "categoria": "TT",
    "marca": "CHEVROLET",
    "modelo": "VITARA",
    "piloto": "LUIS ARMANDO PE√ëA GRANDA",
    "copiloto": "KEVIN RENE MACAS JIMENEZ",
    "ciudad": "ESMERALDAS"
  },
  {
    "auto": 764,
    "categoria": "CAMIONETAS",
    "marca": "JAC",
    "modelo": "T8 FRISON",
    "piloto": "JOHN LUCIO ZABALETA PE√ëA",
    "copiloto": "KARINA FERNANDA ZABALETA ZEAS",
    "ciudad": "LOJA"
  },
  {
    "auto": 788,
    "categoria": "CAMIONETAS",
    "marca": "JAC",
    "modelo": "T8",
    "piloto": "MARLON RODRIGO MEJIA LUZURIAGA",
    "copiloto": "JORGE LUIS MEJIA LUZURIAGA",
    "ciudad": "LOJA"
  },
  {
    "auto": 917,
    "categoria": "UTV",
    "marca": "CAN-AM",
    "modelo": "MAVERICK X3",
    "piloto": "JUAN DIEGO SARMIENTO SARMIENTO",
    "copiloto": "ELVIS PATRICIO RAMIREZ MURILLO",
    "ciudad": "CUENCA"
  },
  {
    "auto": 924,
    "categoria": "UTV",
    "marca": "CAN-AM",
    "modelo": "MAVERICK R",
    "piloto": "JUAN DANIEL BERNAL I√ëIGUEZ",
    "copiloto": "JOSE ALEJANDRO MORAN VASQUEZ",
    "ciudad": "CUENCA"
  },
  {
    "auto": 926,
    "categoria": "UTV",
    "marca": "CAN-AM",
    "modelo": "MAVERICK X",
    "piloto": "MARCO VINICIO JIMENEZ TORRES",
    "copiloto": "JEMNER RENE CUEVA MEJIA",
    "ciudad": "CALVAS"
  },
  {
    "auto": 933,
    "categoria": "UTV",
    "marca": "CAN-AM",
    "modelo": "MAVERICK R",
    "piloto": "TOMAS FRANCISCO SALDA√ëA SALCEDO",
    "copiloto": "CRISTIAN ANDRES CORDERO IZQUIERDO",
    "ciudad": "CUENCA"
  },
  {
    "auto": 935,
    "categoria": "UTV",
    "marca": "CAN-AM",
    "modelo": "MAVERICK R",
    "piloto": "JAVIER CRISTOBAL MEDINA AGUIRRE",
    "copiloto": "PABLO SEBASTIAN PEREZ MAYA",
    "ciudad": "CUENCA"
  },
  {
    "auto": 946,
    "categoria": "UTV",
    "marca": "CAN-AM",
    "modelo": "MAVERICK",
    "piloto": "DIEGO FERNANDO TOBAR TOVAR",
    "copiloto": "PEDRO RENATO BUSTAMANTE AMOROSO",
    "ciudad": "LATACUNGA"
  }
];

        const CRONOGRAMA = {
  "etapas": [
    {
      "nombre": "SUPER PRIME DE CLASIFICACION Y SUPER PRIME",
      "tramos": [
        {
          "Prime": "SP",
          "nombre": "PISTA SECTOR LA JOYA",
          "km": 5.5,
          "hora": "13:18:00"
        },
        {
          "Prime": "TC1",
          "nombre": "PISTA SECTOR LA JOYA",
          "km": 12.9,
          "hora": "14:18:00"
        }
      ]
    },
    {
      "nombre": "ETAPA 1 (Chimborazo - Bolivar - Tungurahua - Cotopaxi)",
      "tramos": [
        {
          "Prime": "TC1",
          "nombre": "BUCAY - LAMIRAN",
          "km": 13.2,
          "hora": "8:58:00"
        },
        {
          "Prime": "TC2",
          "nombre": "CHILLANES - VIA MATAPALO",
          "km": 18.35,
          "hora": "9:40:00"
        },
        {
          "Prime": "TC3",
          "nombre": "PIRCABAMBA - QUINDIGUA",
          "km": 27.14,
          "hora": "11:51:00"
        },
        {
          "Prime": "TC4",
          "nombre": "Y DE CALAMACA - AGUAJAN - MIRAFLORES",
          "km": 29.1,
          "hora": "13:23:00"
        },
        {
          "Prime": "TC5",
          "nombre": "BELISARIO QUEVEDO ESPE - SAN MARTIN",
          "km": 16.69,
          "hora": "14:46:00"
        }
      ]
    },
    {
      "nombre": "2DA ETAPA (Pichincha - Imbabura)",
      "tramos": [
        {
          "Prime": "TC1",
          "nombre": "INGRESO AL RELLENO SANITARIO (2KM ANTES DEL PEAJE COCHASQUI) - TANDA",
          "km": 7.32,
          "hora": "8:33:00"
        },
        {
          "Prime": "TC2",
          "nombre": "CUMALPI - SELVA ALEGRE KM12",
          "km": 14.5,
          "hora": "10:12:00"
        },
        {
          "Prime": "TC3",
          "nombre": "IRUGUINCHO - URCUSIQUI - QUIROGA",
          "km": 12,
          "hora": "10:52:00"
        },
        {
          "Prime": "TC4",
          "nombre": "LA GRACIELA - ESTACION DEL TREN - SAN ELOY",
          "km": 23,
          "hora": "12:35:00"
        },
        {
          "Prime": "TC5",
          "nombre": "PISTA TUNIBAMBA",
          "km": 7.5,
          "hora": "13:26:00"
        }
      ]
    },
    {
      "nombre": "3ERA ETAPA (TUNGURAHUA)",
      "tramos": [
        {
          "Prime": "TC1",
          "nombre": "QUISAPINCHA - 4 ESQUINAS - ASPACHACA",
          "km": 15.9,
          "hora": "8:53:00"
        },
        {
          "Prime": "TC2",
          "nombre": "LOMA GORDA - MULACORRAL - TILIVI",
          "km": 38,
          "hora": "9:49:00"
        },
        {
          "Prime": "TC3",
          "nombre": "LOMA GORDA - MULACORRAL - TILIVI",
          "km": 38,
          "hora": "11:28:00"
        },
        {
          "Prime": "TC4",
          "nombre": "PASA - MOGATO - SIGUITAG - ASPACHACA",
          "km": 15.1,
          "hora": "12:27:00"
        },
        {
          "Prime": "TC5",
          "nombre": "AGUAJAN - AVENIDA MANUELITA SAENZ",
          "km": 10.6,
          "hora": "13:11:00"
        }
      ]
    },
    {
      "nombre": "4TA ETAPA (Chimborazo - Morona Santiago - Azuay - Loja)",
      "tramos": [
        {
          "Prime": "TC1",
          "nombre": "YARUQUIES - ALAHAGUAN",
          "km": 17,
          "hora": "6:43:00"
        },
        {
          "Prime": "TC2",
          "nombre": "ZU√ëAC - AEROPUERTO DE MACAS",
          "km": 40,
          "hora": "8:48:00"
        },
        {
          "Prime": "TC3",
          "nombre": "REMIGIO MADERO - VIA A SUCUA",
          "km": 8.8,
          "hora": "9:54:00"
        },
        {
          "Prime": "TC4",
          "nombre": "ESTADIO DE GUALACEO - ANTIGUO PEAJE CHAQUILCAY",
          "km": 17.82,
          "hora": "13:08:00"
        },
        {
          "Prime": "TC5",
          "nombre": "ZHI√ëA - NABON",
          "km": 22.76,
          "hora": "15:10:00"
        },
        {
          "Prime": "TC6",
          "nombre": "URDANETA - SARAGURO",
          "km": 18,
          "hora": "16:44:00"
        }
      ]
    },
    {
      "nombre": "5TA ETAPA (Loja - El Oro)",
      "tramos": [
        {
          "Prime": "TC1",
          "nombre": "MOTUPE - VIA A CUENCA",
          "km": 8.15,
          "hora": "8:48:00"
        },
        {
          "Prime": "TC2",
          "nombre": "VIA GONZANAMA - LA VEGA - GUAYABAL",
          "km": 9.3,
          "hora": "9:27:00"
        },
        {
          "Prime": "TC3",
          "nombre": "ZAMBI - PUENTE RIO PINDO",
          "km": 40.01,
          "hora": "10:27:00"
        },
        {
          "Prime": "TC4",
          "nombre": "LA FLORIDA - CIUDADELA JUAN PABLO I",
          "km": 6.04,
          "hora": "12:17:00"
        },
        {
          "Prime": "TC5",
          "nombre": "LOS NARANJOS - LAS ORQUIDEAS",
          "km": 7.25,
          "hora": "13:09:00"
        },
        {
          "Prime": "TC6",
          "nombre": "PISTA DE LA AVANZADA",
          "km": 4.7,
          "hora": "14:17:00"
        }
      ]
    }
  ]
};

        // Base de datos en memoria
        let tiempos = {};
        let posicionesAnteriores = {};

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            initializeDatabase();
            populateSelects();
            startAutoUpdate();
        });

        function initializeDatabase() {
            // Estructura: tiempos[etapaIndex][tramoIndex][autoNumber] = {tiempo, timestamp}
            for (let i = 0; i < CRONOGRAMA.etapas.length; i++) {
                tiempos[i] = {};
                for (let j = 0; j < CRONOGRAMA.etapas[i].tramos.length; j++) {
                    tiempos[i][j] = {};
                }
            }
        }

        function populateSelects() {
            // Poblar selector de etapas
            const etapaSelect = document.getElementById('etapaSelect');
            const etapaFilter = document.getElementById('etapaFilter');
            
            CRONOGRAMA.etapas.forEach((etapa, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `Etapa ${index}: ${etapa.nombre}`;
                etapaSelect.appendChild(option.cloneNode(true));
                etapaFilter.appendChild(option);
            });

            // Poblar selector de autos
            const autoSelect = document.getElementById('autoNumber');
            INSCRIPTOS.forEach(inscrito => {
                const option = document.createElement('option');
                option.value = inscrito.auto;
                option.textContent = `#${inscrito.auto} - ${inscrito.piloto}`;
                autoSelect.appendChild(option);
            });

            // Poblar filtros de categor√≠a
            const categorias = [...new Set(INSCRIPTOS.map(i => i.categoria))];
            const categoriaFilter = document.getElementById('categoriaFilter');
            const generalCategoriaFilter = document.getElementById('generalCategoriaFilter');
            
            categorias.forEach(categoria => {
                const option = document.createElement('option');
                option.value = categoria;
                option.textContent = categoria;
                categoriaFilter.appendChild(option.cloneNode(true));
                generalCategoriaFilter.appendChild(option);
            });
        }

        function updateTramos() {
            const etapaIndex = document.getElementById('etapaSelect').value;
            const tramoSelect = document.getElementById('tramoSelect');
            
            tramoSelect.innerHTML = '<option value="">Seleccionar Tramo</option>';
            
            if (etapaIndex !== '') {
                const etapa = CRONOGRAMA.etapas[etapaIndex];
                etapa.tramos.forEach((tramo, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${tramo.Prime} - ${tramo.nombre} (${tramo.km}km)`;
                    tramoSelect.appendChild(option);
                });
            }
            
            updateCurrentStageTable();
        }

        function saveTime() {
            const etapaIndex = document.getElementById('etapaSelect').value;
            const tramoIndex = document.getElementById('tramoSelect').value;
            const autoNumber = document.getElementById('autoNumber').value;
            const hours = document.getElementById('hours').value || '0';
            const minutes = document.getElementById('minutes').value || '0';
            const seconds = document.getElementById('seconds').value || '0';
            const milliseconds = document.getElementById('milliseconds').value || '0';

            if (!etapaIndex || !tramoIndex || !autoNumber) {
                alert('Por favor complete todos los campos requeridos');
                return;
            }

            const tiempo = `${hours.padStart(2, '0')}:${minutes.padStart(2, '0')}:${seconds.padStart(2, '0')}.${milliseconds.padStart(2, '0')}`;
            
            // Guardar tiempo
            tiempos[etapaIndex][tramoIndex][autoNumber] = {
                tiempo: tiempo,
                timestamp: new Date().toISOString(),
                timeInMs: timeToMilliseconds(tiempo)
            };

            // Limpiar formulario
            document.getElementById('hours').value = '';
            document.getElementById('minutes').value = '';
            document.getElementById('seconds').value = '';
            document.getElementById('milliseconds').value = '';

            // Actualizar tabla actual
            updateCurrentStageTable();
            
            alert(`Tiempo guardado: Auto #${autoNumber} - ${tiempo}`);
        }

        function timeToMilliseconds(timeStr) {
            const parts = timeStr.split(':');
            const secondsPart = parts[2].split('.');
            return (parseInt(parts[0]) * 3600 + parseInt(parts[1]) * 60 + parseInt(secondsPart[0])) * 1000 + parseInt(secondsPart[1]) * 10;
        }

        function millisecondsToTime(ms) {
            const hours = Math.floor(ms / 3600000);
            const minutes = Math.floor((ms % 3600000) / 60000);
            const seconds = Math.floor((ms % 60000) / 1000);
            const milliseconds = Math.floor((ms % 1000) / 10);
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${milliseconds.toString().padStart(2, '0')}`;
        }

        function updateCurrentStageTable() {
            const etapaIndex = document.getElementById('etapaSelect').value;
            const tramoIndex = document.getElementById('tramoSelect').value;
            const tbody = document.getElementById('currentStageBody');

            if (!etapaIndex || !tramoIndex) {
                tbody.innerHTML = '<tr><td colspan="5">Seleccione etapa y tramo</td></tr>';
                return;
            }

            const tramotiempos = tiempos[etapaIndex][tramoIndex];
            const results = [];

            for (const autoNumber in tramotiempos) {
                const inscrito = INSCRIPTOS.find(i => i.auto == autoNumber);
                if (inscrito) {
                    results.push({
                        auto: autoNumber,
                        piloto: inscrito.piloto,
                        tiempo: tramotiempos[autoNumber].timeInMs,
                        tiempoStr: tramotiempos[autoNumber].tiempo
                    });
                }
            }

            results.sort((a, b) => a.tiempo - b.tiempo);

            let html = '';
            results.forEach((result, index) => {
                const differential = index === 0 ? '00:00:00.00' : millisecondsToTime(result.tiempo - results[0].tiempo);
                html += `
                    <tr>
                        <td class="position">${index + 1}</td>
                        <td>#${result.auto}</td>
                        <td>${result.piloto}</td>
                        <td class="time">${result.tiempoStr}</td>
                        <td class="differential">${differential}</td>
                    </tr>
                `;
            });

            tbody.innerHTML = html || '<tr><td colspan="5">No hay tiempos registrados</td></tr>';
        }

        function showScreen(screenName) {
            // Ocultar todas las pantallas
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Remover clase active de todos los botones
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Mostrar pantalla seleccionada
            document.getElementById(screenName).classList.add('active');
            
            // Activar bot√≥n correspondiente
            event.target.classList.add('active');
            
            // Actualizar datos seg√∫n la pantalla
            if (screenName === 'visualization') {
                updateVisualizationTable();
            } else if (screenName === 'general') {
                updateGeneralTable();
            }
        }

        function updateVisualizationTable() {
            const tbody = document.getElementById('visualizationBody');
            const etapaFilter = document.getElementById('etapaFilter').value;
            const categoriaFilter = document.getElementById('categoriaFilter').value;

            // Calcular tiempos por etapa para cada piloto
            const resultados = {};
            
            INSCRIPTOS.forEach(inscrito => {
                if (categoriaFilter && inscrito.categoria !== categoriaFilter) return;
                
                resultados[inscrito.auto] = {
                    ...inscrito,
                    tiemposPorEtapa: {},
                    tiempoTotal: 0
                };
            });

            // Calcular tiempos por etapa
            for (let etapaIndex = 0; etapaIndex < CRONOGRAMA.etapas.length; etapaIndex++) {
                if (etapaFilter && etapaFilter != etapaIndex) continue;
                
                for (const autoNumber in resultados) {
                    let tiempoEtapa = 0;
                    let tienetiempos = false;
                    
                    for (let tramoIndex = 0; tramoIndex < CRONOGRAMA.etapas[etapaIndex].tramos.length; tramoIndex++) {
                        if (tiempos[etapaIndex] && tiempos[etapaIndex][tramoIndex] && tiempos[etapaIndex][tramoIndex][autoNumber]) {
                            tiempoEtapa += tiempos[etapaIndex][tramoIndex][autoNumber].timeInMs;
                            tienetiempos = true;
                        }
                    }
                    
                    if (tienetiempos) {
                        resultados[autoNumber].tiemposPorEtapa[etapaIndex] = tiempoEtapa;
                        resultados[autoNumber].tiempoTotal += tiempoEtapa;
                    }
                }
            }

            // Filtrar solo pilotos con tiempos y ordenar
            const pilotos = Object.values(resultados)
                .filter(piloto => piloto.tiempoTotal > 0)
                .sort((a, b) => a.tiempoTotal - b.tiempoTotal);

            let html = '';
            pilotos.forEach((piloto, index) => {
                const posicionAnterior = posicionesAnteriores[piloto.auto] || index + 1;
                let cambio = '';
                let claseposicion = '';
                
                if (posicionAnterior > index + 1) {
                    cambio = `‚Üë${posicionAnterior - (index + 1)}`;
                    claseposicion = 'position-up';
                } else if (posicionAnterior < index + 1) {
                    cambio = `‚Üì${(index + 1) - posicionAnterior}`;
                    claseposicion = 'position-down';
                } else {
                    cambio = '=';
                    claseposicion = 'neutral';
                }

                const differential = index === 0 ? '00:00:00.00' : millisecondsToTime(piloto.tiempoTotal - pilotos[0].tiempoTotal);
                
                html += `
                    <tr>
                        <td class="position">${index + 1}</td>
                        <td class="${claseposicion}">${cambio}</td>
                        <td>#${piloto.auto}</td>
                        <td>${piloto.piloto}</td>
                        <td>${piloto.categoria}</td>
                        <td>${piloto.ciudad}</td>
                        <td class="time">${millisecondsToTime(piloto.tiempoTotal)}</td>
                        <td class="differential">${differential}</td>
                    </tr>
                `;
                
                posicionesAnteriores[piloto.auto] = index + 1;
            });

            tbody.innerHTML = html || '<tr><td colspan="8">No hay datos disponibles</td></tr>';
            document.getElementById('lastUpdateTime').textContent = new Date().toLocaleTimeString();
        }

        function updateGeneralTable() {
            const tbody = document.getElementById('generalBody');
            const categoriaFilter = document.getElementById('generalCategoriaFilter').value;

            // Calcular clasificaci√≥n general
            const resultados = {};
            
            INSCRIPTOS.forEach(inscrito => {
                if (categoriaFilter && inscrito.categoria !== categoriaFilter) return;
                
                resultados[inscrito.auto] = {
                    ...inscrito,
                    tiempoTotal: 0,
                    etapasCompletadas: 0
                };
            });

            // Sumar todos los tiempos de todas las etapas
            for (let etapaIndex = 0; etapaIndex < CRONOGRAMA.etapas.length; etapaIndex++) {
                for (const autoNumber in resultados) {
                    let tiempoEtapa = 0;
                    let tramosCompletos = 0;
                    
                    for (let tramoIndex = 0; tramoIndex < CRONOGRAMA.etapas[etapaIndex].tramos.length; tramoIndex++) {
                        if (tiempos[etapaIndex] && tiempos[etapaIndex][tramoIndex] && tiempos[etapaIndex][tramoIndex][autoNumber]) {
                            tiempoEtapa += tiempos[etapaIndex][tramoIndex][autoNumber].timeInMs;
                            tramosCompletos++;
                        }
                    }
                    
                    if (tramosCompletos > 0) {
                        resultados[autoNumber].tiempoTotal += tiempoEtapa;
                        if (tramosCompletos === CRONOGRAMA.etapas[etapaIndex].tramos.length) {
                            resultados[autoNumber].etapasCompletadas++;
                        }
                    }
                }
            }

            // Filtrar y ordenar
            const pilotos = Object.values(resultados)
                .filter(piloto => piloto.tiempoTotal > 0)
                .sort((a, b) => a.tiempoTotal - b.tiempoTotal);

            let html = '';
            pilotos.forEach((piloto, index) => {
                const posicionAnterior = posicionesAnteriores[`general_${piloto.auto}`] || index + 1;
                let cambio = '';
                let claseposicion = '';
                
                if (posicionAnterior > index + 1) {
                    cambio = `‚Üë${posicionAnterior - (index + 1)}`;
                    claseposicion = 'position-up';
                } else if (posicionAnterior < index + 1) {
                    cambio = `‚Üì${(index + 1) - posicionAnterior}`;
                    claseposicion = 'position-down';
                } else {
                    cambio = '=';
                    claseposicion = 'neutral';
                }

                const differential = index === 0 ? '00:00:00.00' : millisecondsToTime(piloto.tiempoTotal - pilotos[0].tiempoTotal);
                
                html += `
                    <tr>
                        <td class="position">${index + 1}</td>
                        <td class="${claseposicion}">${cambio}</td>
                        <td>#${piloto.auto}</td>
                        <td>${piloto.piloto}<br><small>${piloto.copiloto}</small></td>
                        <td>${piloto.categoria}</td>
                        <td>${piloto.ciudad}</td>
                        <td class="time">${millisecondsToTime(piloto.tiempoTotal)}</td>
                        <td class="differential">${differential}</td>
                        <td>${piloto.etapasCompletadas}/${CRONOGRAMA.etapas.length}</td>
                    </tr>
                `;
                
                posicionesAnteriores[`general_${piloto.auto}`] = index + 1;
            });

            tbody.innerHTML = html || '<tr><td colspan="9">No hay datos disponibles</td></tr>';
            document.getElementById('lastUpdateGeneral').textContent = new Date().toLocaleTimeString();
        }

        function filterResults() {
            updateVisualizationTable();
        }

        function filterGeneral() {
            updateGeneralTable();
        }

        function startAutoUpdate() {
            // Actualizar cada minuto
            setInterval(() => {
                const activeScreen = document.querySelector('.screen.active').id;
                if (activeScreen === 'visualization') {
                    updateVisualizationTable();
                } else if (activeScreen === 'general') {
                    updateGeneralTable();
                }
            }, 60000);
        }

        // Funci√≥n para exportar datos (para GitHub)
        function exportData() {
            return {
                tiempos: tiempos,
                timestamp: new Date().toISOString(),
                inscriptos: INSCRIPTOS,
                cronograma: CRONOGRAMA
            };
        }

        // Funci√≥n para importar datos (desde GitHub)
        function importData(data) {
            if (data && data.tiempos) {
                tiempos = data.tiempos;
                updateVisualizationTable();
                updateGeneralTable();
            }
        }

        // Datos de ejemplo para demostraci√≥n
        function loadSampleData() {
            // Algunos tiempos de ejemplo
            tiempos[0] = {
                0: {
                    16: {tiempo: "00:05:45.23", timeInMs: 345230, timestamp: new Date().toISOString()},
                    19: {tiempo: "00:05:48.10", timeInMs: 348100, timestamp: new Date().toISOString()},
                    50: {tiempo: "00:06:02.45", timeInMs: 362450, timestamp: new Date().toISOString()}
                },
                1: {
                    16: {tiempo: "00:12:15.67", timeInMs: 735670, timestamp: new Date().toISOString()},
                    19: {tiempo: "00:12:20.34", timeInMs: 740340, timestamp: new Date().toISOString()},
                    50: {tiempo: "00:12:45.89", timeInMs: 765890, timestamp: new Date().toISOString()}
                }
            };
        }

        // Cargar datos de ejemplo al inicio
        setTimeout(loadSampleData, 1000);
    </script>
</body>
</html>
